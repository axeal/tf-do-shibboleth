# Terraform config to launch a shibboleth idp lab with openldap in Kubernetes

**Note: requires Terraform v0.12**

## Summary

This terraform setup will:

- Configure a [Shibboleth IDP Deployment](https://github.com/Unicon/shibboleth-idp-dockerized), with an [OpenLDAP backend](https://github.com/osixia/docker-openldap) Deployment, and [phpLDAPadmin](https://github.com/osixia/docker-phpLDAPadmin) Deployment.
- Generate local `rancher.key`, `rancher.crt` and `idp-metadata.xml` files used to configure the Rancher Shibboleth authentication provider.

## Requirements
- You will need to define a hostname (e.g. `shibboleth`) for the shibboleth ingress, as well as the domain (e.g. `example.org`). This FQDN (e.g. `shibboleth.example.org`) will need to point in DNS to the ingress of the Kubernetes cluster into which you are deploying Shibboleth.

## How to use

- Clone this repository
- Move the file `terraform.tfvars.example` to `terraform.tfvars` and edit (see inline explanation)
- Source the kubeconfig of the cluster into which to deploy the Shibboleth stack `export KUBECONFIG=<path_to_kube_config_file>`
- Run `terraform apply`
- Configure [Shibboleth authentication in Rancher](https://rancher.com/docs/rancher/v2.x/en/admin-settings/authentication/shibboleth/). Use the `rancher.key`, `rancher.crt` and `idp-metadata.xml` files generated by Terraform in the root folder of this module.